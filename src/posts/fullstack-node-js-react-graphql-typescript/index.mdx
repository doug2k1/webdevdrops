---
title: 'Fullstack com Node.js, React e GraphQL - 8: Frontend React e TypeScript'
date: '2019-11-07'
categories:
  - 'Full Stack'
tags:
  - 'full-stack'
  - 'react'
  - 'typescript'
coverImage: '/fullstack-node-js-react-graphql-typescript/images/fullstack-8-1.jpg'
---

Fala, galera! Depois de uma longa pausa estamos de volta, e nesta oitava parte da s√©rie **[Fullstack com Node.js, React e GraphQL](/fullstack-node-react-graphql-introducao-2c2f18c757c4/)** vamos come√ßar a desenvolver o frontend com **[React](https://reactjs.org/)**, usando a linguagem **[TypeScript](https://www.typescriptlang.org/)**, escrevendo CSS com **[styled-components](https://www.styled-components.com/)** e a biblioteca de componentes **[Material-UI](https://material-ui.com/)**.

<PostImage
  src="/fullstack-node-js-react-graphql-typescript/images/fullstack-8-1-1024x558.jpg"
  width="1024"
  height="558"
  alt=""
/>

## Mas antes...

Como o projeto ficou um tempo parado, resolvi atualizar todas as depend√™ncias para deixar o projeto atual. Algumas atualiza√ß√µes tinham _breaking changes_, mas atualizei o que foi necess√°rio e est√° tudo funcionando no reposit√≥rio.

Uma das principais mudan√ßas foi que o **Apollo Server** agora oferece o **[GraphQL Playground](https://www.apollographql.com/docs/apollo-server/testing/graphql-playground/)**, ao inv√©s do **GraphiQL**, como interface gr√°fica para testar queries. Mas o funcionamento √© praticamente o mesmo.

## Escolha da stack frontend

Como este √© o primeiro post que envolve frontend, vou dar uma breve explica√ß√£o da escolha das tecnologias:

### TypeScript

O uso do **[TypeScript](https://www.typescriptlang.org/)** vem crescendo nos √∫ltimos anos (veja abaixo o gr√°fico de downloads nos √∫ltimos 2 anos), e √© cada vez mais importante que o desenvolvedor web tenha esse conhecimento no seu arsenal.

<PostImage
  src="/fullstack-node-js-react-graphql-typescript/images/fullstack-8-2-1024x538.png"
  width="1024"
  height="538"
  alt=""
/>

Downloads do m√≥dulo typescript no NPM (via npmtrends.com)

O **TypeScript** adiciona um pouco mais de complexidade ao setup e deixa o c√≥digo mais verboso, com a adi√ß√£o das declara√ß√µes de tipos. Por√©m isso √© compensado pelas vantagens, como detectar bugs ainda durante a codifica√ß√£o, melhorar o auto-complete do editor, facilitar refatora√ß√µes de c√≥digo.

### Styled Components

**[styled-components](https://www.typescriptlang.org/)** √© uma lib para escrita de CSS que vem em uma crescente, assim como o **TypeScript**. Ela traz o paradigma **CSS-in-JS**, que encoraja o acoplamento do CSS com o HTML e JS de um componente.

Mesmo que isso n√£o pare√ßa uma boa ideia a princ√≠pio, ela traz vantagens como:

- Carrega apenas o CSS necess√°rio para os componentes que est√£o na tela.
- Elimina conflito de estilos entre componentes.
- Facilita a manuten√ß√£o: todo CSS que afeta um componente est√° junto dele.
- Facilita cria√ß√£o de estilos din√¢micos, baseados na propriedades e estado do componente.

### Material-UI

Vamos usar o padr√£o **[Material Design](https://material.io/design/)**, do Google, para facilitar a implementa√ß√£o da parte visual da aplica√ß√£o.

Dentre as implementa√ß√µes do **Material Design** em componentes React, o **[Material-UI](https://material-ui.com/)** √© uma das mais maduras e completas.

## Fazendo o setup

### Babel

Para fazer a _transpila√ß√£o_ do c√≥digo **TypeScript** para **JavaScript** (que √© o que o navegador entende) vamos usar o **[Babel](https://babeljs.io/)**.

Para isso vamos instalar nas depend√™ncias de desenvolvimento:

npm i -D @babel/core @babel/preset-env @babel/preset-react @babel/preset-typescript @babel/plugin-proposal-object-rest-spread

Al√©m do _core_ do Babel, estamos instalando:

- **@babel/preset-env**: transforma _features_ mais novas do **JavaScript** para c√≥digo compat√≠vel com navegadores que n√£o suportam nativamente
- **@babel/preset-react**: transforma c√≥digo **[JSX](https://pt-br.reactjs.org/docs/introducing-jsx.html)** do **React** em **JavaScript**.
- **@babel/preset-typescript**: transforma **TypeScript** em **JavaScript**.
- **@babel/plugin-proposal-object-rest-spread**: adiciona suporte a [object rest spread](https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/Spread_syntax), que ainda n√£o est√° na vers√£o oficial do **JavaScript** ([mas est√° a caminho](https://github.com/tc39/proposal-object-rest-spread))

#### Configura√ß√£o

Nossa configura√ß√£o do **Babel**, que fica no arquivo _.babelrc_, √© bem simples. Apenas ativamos os _presets_ e o _plugin_ que instalamos:

```json
{
  "presets": ["@babel/env", "@babel/typescript", "@babel/react"],
  "plugins": ["@babel/proposal-object-rest-spread"]
}
```

### Webpack

Para usarmos o **[webpack](https://webpack.js.org/)**, vamos instalar as depend√™ncias de desenvolvimento:

npm i -D babel-loader webpack webpack-cli webpack-dev-server

ü§î N√£o sabe pra que serve o **webpack** ou como ele funciona? Leia a s√©rie de posts **[Webpack sem Medo](/webpack-sem-medo-introducao-af889eb659e7/)**, onde explico tudo.

O que estamos instalando?

- **babel-loader**: loader que integra com o **Babel** para fazer a transpila√ß√£o do c√≥digo.
- **webpack**: o core do **webpack**
- **webpack-cli**: cli (interface de linha de comando) do **webpack**, necess√°ria para executar alguns comandos, como fazer o _build_ dos _assets_.
- **webpack-dev-server**: servidor de desenvolvimento integrado com o **webpack**, para processar os arquivos a medida que vamos desenvolvendo.

#### Configura√ß√£o

A configura√ß√£o do **webpack**, no arquivo _webpack.config.js_, fica assim:

```javascript
const path = require('path')

module.exports = (env) => ({
  mode: env === 'prod' ? 'production' : 'development',

  entry: './src/index',

  output: {
    path: path.resolve('dist'),
    filename: 'bundle.js',
  },

  resolve: {
    extensions: ['.ts', '.tsx', '.js', '.json'],
  },

  module: {
    rules: [
      {
        test: /\.(tsx?)|(js)$/,
        exclude: /node_modules/,
        loader: 'babel-loader',
        options: {
          cacheDirectory: true,
        },
      },
    ],
  },
})
```

Alguns pontos a se notar:

`mode: env === 'prod' ? 'production' : 'development'`  
Usamos o par√¢metro de linha de comando _env_ para setar o modo produ√ß√£o ou desenvolvimento.

`extensions: ['.ts', '.tsx', '.js', '.json']`  
Adicionamos as extens√µes .ts e .tsx para trabalhamos com **TypeScript**.

A √∫nica regra que temos em `modules` trata os arquivos com extens√µes .ts, .tsx e .js, passando para o **babel-loader**, que vai cuidar das transforma√ß√µes.

#### NPM scripts

Para facilitar a nossa vida, vamos adicionar dois scripts no _package.json_, o `start` para iniciar o servidor de desenvolvimento e o `build` para compilar em modo de produ√ß√£o:

```json
  "scripts": {
    "start": "webpack-dev-server",
    "build": "webpack --env prod"
  }
```

### TypeScript

Vamos instalar como depend√™ncia de desenvolvimento:

```bash
npm i -D typescript
```

Esta instala√ß√£o disponibiliza o execut√°vel _tsc_ (**TypeScript** compiler).

#### Configura√ß√£o

O **TypeScript** usa o arquivo de configura√ß√£o _tsconfig.json_. Podemos gerar uma vers√£o inicial deste arquivo rodando:

```bash
npx tsc --init
```

Ele vai gerar um _tsconfig.json_ com valores default (e mais um monte de coment√°rios explicando resumidamente cada op√ß√£o).

Nosso tsconfig, ap√≥s algumas altera√ß√µes, ficou assim:

```json
{
  "compilerOptions": {
    "target": "esnext",
    "module": "commonjs",
    "jsx": "preserve",
    "strict": true,
    "esModuleInterop": true
  }
}
```

Fizemos duas altera√ß√µes na config padr√£o:

`"target": "esnext"`  
Deixamos o compilador de **TypeScript** compilar para a vers√£o mais avan√ßada de **JavaScript**. Da√≠ pra frente, para compilar funcionalidades espec√≠ficas para vers√µes mais compat√≠veis dos navegadores fica a cargo do **Babel**.

`"jsx": "preserve"`  
Temos que habilitar o parsing de JSX, mas sem fazer nenhuma altera√ß√£o. Transformar JSX em JS fica a cargo do **Babel** com o **preset-react**.

### React, Styled Components, Material UI

Agora que preparamos o palco, vamos trazer o atores principais:

```bash
npm i react react-dom styled-components @material-ui/core
```

√â recomend√°vel instalar tamb√©m as defini√ß√µes de tipos para essas libs:

```bash
npm i @types/react @types/react-dom @types/styled-components
```

ü§î **Porque eu preciso destas instala√ß√µes extra?**

Muitas libs n√£o possuem suas pr√≥prias defini√ß√µes de tipos. Quando importamos um m√≥dulo destes em um arquivo **TypeScript**, o compilador assume o tipo `any` para o que est√° sendo importado.

O tipo `any` significa que pode ser qualquer coisa, ou basicamente que nenhum tipo foi definido. Como estamos em modo _strict_ (definido no _tsconfig_), o compilador requer que os m√≥dulos tenham tipos definidos.

Nem todo autor de libs tem interesse em adicionar defini√ß√µes de tipos em suas libs. Para estes casos existe o **[DefinitelyTyped](http://definitelytyped.org/)**, uma iniciativa open-source onde pessoas contribuem com defini√ß√µes de tipos para v√°rias libs. Estas defini√ß√µes da comunidade s√£o publicadas no **NPM** sob o escopo **@types**.

Por isso instalamos os @types... ali em cima. Al√©m de cumprir as exig√™ncias do compilador, √© mais f√°cil trabalhar com libs que possuem tipos definidos. As sugest√µes de auto-complete e as indica√ß√µes de erro no editor ficam muito mais inteligentes.

Vamos criar um _index.html_:

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="minimum-scale=1, initial-scale=1, width=device-width, shrink-to-fit=no"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>React</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
    />
  </head>
  <body>
    <div id="app"></div>
    <script src="bundle.js"></script>
  </body>
</html>
```

Veja que adicionamos uma refer√™ncia para a fonte **[Roboto](https://fonts.google.com/specimen/Roboto)**, do **Google Fonts**, que √© a fonte utilizada pelo **Material UI**.

Vamos criar tamb√©m o ponto de entrada para nossa aplica√ß√£o, o _src/index.tsx_:

```jsx
import React from 'react'
import ReactDOM from 'react-dom'
import App from './App'

ReactDOM.render(<App name="Web Dev Drops" />, document.getElementById('app'))
```

## O primeiro componente

Vamos criar o componente _src/App.tsx_ que √© referenciado no index. Por enquanto este componente vai servir apenas para testar o nosso setup.

Veja o componente inteiro. Na sequ√™ncia eu explico cada parte.

```tsx
import React, { useState } from 'react'
import styled from 'styled-components'
import Button from '@material-ui/core/Button'
import CssBaseline from '@material-ui/core/CssBaseline'
import { StylesProvider } from '@material-ui/core/styles'

const StyledH1 = styled.h1`
  font-size: 30px;
  text-transform: uppercase;
`

type Props = {
  name: string
}

const App: React.FC<Props> = ({ name }) => {
  const [who, setWho] = useState('World')

  return (
    <StylesProvider injectFirst>
      <CssBaseline />
      <StyledH1>React App</StyledH1>
      <p>
        Hello {who}! This is {name}!
      </p>
      <Button variant="contained" color="primary">
        Material Button
      </Button>
    </StylesProvider>
  )
}

export default App
```

### Styled component

A primeira coisa que ele faz √© declarar um componente `StyledH1` usando o **styled-components**.

```javascript
const StyledH1 = styled.h1`
  font-size: 30px;
  text-transform: uppercase;
`
```

O que ele faz aqui √© criar um componente que renderiza uma tag `h1` com aqueles estilos aplicados.

A magia aqui √© que eu posso usar o `StyledH1` v√°rias vezes e ele sempre vai vir com os estilos. N√£o preciso me preocupar em criar um arquivo .css e import√°-lo no componente. Estilos de outros componentes n√£o v√£o conflitar com este.

### Declarando props com tipos

O pr√≥ximo passo √© declarar as _props_ que o componente recebe, especificando os tipos.

```ts
type Props = {
  name: string
}
```

O componente `App` s√≥ recebe uma _prop_ `name`, do tipo `string`. Com essa declara√ß√£o o **TypeScript** vai validar se eu tentar passar alguma _prop_ diferente ou com o tipo errado, dando erro na compila√ß√£o.

### O componente

Por fim, vamos declarar o componente:

```tsx
const App: React.FC<Props> = ({ name }) => {
  const [who, setWho] = useState('World');

  ...
}
```

Aqui eu declaro um componente funcional (`React.FC`) que recebe as pros declaradas mais acima (`React.FC<Props>`).

Na segunda linha eu declaro uma vari√°vel de estado do componente, usando o [hook](https://pt-br.reactjs.org/docs/hooks-intro.html) `useState`.

Na sequ√™ncia eu retorno o que o componente vai _renderizar_:

```jsx
return (
  <StylesProvider injectFirst>
    <CssBaseline />
    <StyledH1>React App</StyledH1>
    <p>
      Hello {who}! This is {name}!
    </p>
    <Button variant="contained" color="primary">
      Material Button
    </Button>
  </StylesProvider>
)
```

A primeira tag, `<StylesProvider injectFirst>`, serve para controlar como o **Material UI** vai injetar seus estilos. Com `injectFirst` voc√™ consegue sobrescrever com seus pr√≥prios estilos se quiser.

`<CssBaseline />` tamb√©m √© do **Material UI** e adiciona um reset de estilos.

Depois a gente usa o nosso componente `StyledH1` com um texto, exibimos a vari√°vel de estado `who` e a _prop_ `name`, e no fim adicionamos um bot√£o do **Material UI** pra conferir se ele √© renderizado normalmente.

O resultado √© este:

<PostImage
  src="/fullstack-node-js-react-graphql-typescript/images/fullstack-8-3.png"
  width="644"
  height="382"
  alt=""
/>

Nada muito empolgante, mas conseguimos validar o nosso setup. Na pr√≥xima parte vamos come√ßar a criar as telas da nossa aplica√ß√£o de fato.

## Resultado final

O c√≥digo do projeto at√© este ponto est√° em: [https://github.com/doug2k1/my-money/tree/v7.0.0](https://github.com/doug2k1/my-money/tree/v7.0.0)

## No pr√≥ximo cap√≠tulo

Na pr√≥xima parte vamos criar as telas da aplica√ß√£o, usando o setup de frontend que fizemos hoje.

Stay tuned!

## Feedbacks?

E a√≠, o que est√° achando at√© agora? Algo que precisa melhorar?
