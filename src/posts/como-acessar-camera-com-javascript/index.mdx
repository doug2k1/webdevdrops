---
title: 'Como Acessar C√¢mera com JavaScript (Frontal e Traseira)'
date: '2020-05-30'
categories:
  - 'JavaScript'
tags:
  - 'javascript'
coverImage: '/como-acessar-camera-com-javascript/images/javascript-camera.jpg'
translations:
  en: how-to-access-device-cameras-with-javascript
---

E a√≠, pessoal! Neste post vou mostrar como acessar as c√¢meras do dispositivo em uma p√°gina web, via **JavaScript**, com suporte a m√∫ltiplos browsers e sem a necessidade de bibliotecas externas.

<PostImage
  src="/como-acessar-camera-com-javascript/images/javascript-camera.jpg"
  width="940"
  height="788"
  alt=""
  priority
/>

## Como ter acesso √† c√¢mera

Para acessar a c√¢mera (e/ou microfone) do usu√°rio usamos a [**API MediaStream**](https://developer.mozilla.org/en-US/docs/Web/API/Media_Streams_API) do **JavaScript**. Esta API permite acessar o v√≠deo e √°udio capturado por estes dispositivos atrav√©s de [streams](https://developer.mozilla.org/en-US/docs/Web/API/MediaStream).

O primeiro passo √© verificar se o navegador d√° suporte a esta API:

```javascript
if ('mediaDevices' in navigator && 'getUserMedia' in navigator.mediaDevices) {
  // ok, o navegador tem suporte
}
```

O suporte √© at√© decente nos navegadores modernos (nada de Internet Explorer).

## Capturando o stream de v√≠deo

Para capturar o stream de v√≠deo, ou seja, a sequ√™ncia de quadros que est√° sendo gerada pela c√¢mera, usamos o m√©todo `getUserMedia` do objeto `mediaDevices`.

Este m√©todo recebe um objeto com os tipos de m√≠dia que estamos requisitando (video ou audio) e alguns requisitos. Para come√ßar podemos passar apenas `{ video: true }` para pegar o v√≠deo da c√¢mera.

```javascript
const videoStream = await navigator.mediaDevices.getUserMedia({ video: true })
```

Esta chamada vai pedir ao usu√°rio uma permiss√£o para acessar a c√¢mera. Caso o usu√°rio negue, ela lan√ßa uma exce√ß√£o e n√£o retorna o stream. Portanto ela deve ser feita dentro de um bloco [try/catch](https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Statements/try...catch) para tratar esta nega√ß√£o.

<PostImage
  src="/como-acessar-camera-com-javascript/images/camera-permission.png"
  width="716"
  height="362"
  alt="Popup de permiss√£o para acessar a c√¢mera"
/>

Veja que ele retorna uma [Promise](https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Global_Objects/Promise), ent√£o tem que usar o [async/await](https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Statements/funcoes_assincronas) ou o `then`.

## Requisitos de v√≠deo

Podemos melhorar os requisitos do v√≠deo passando informa√ß√µes sobre a resolu√ß√£o desejada e limites de m√≠nimo e m√°ximo:

```javascript
const constraints = {
  video: {
    width: {
      min: 1280,
      ideal: 1920,
      max: 2560,
    },
    height: {
      min: 720,
      ideal: 1080,
      max: 1440,
    },
  },
}

const videoStream = await navigator.mediaDevices.getUserMedia(constraints)
```

Assim o stream vem na propor√ß√£o correta de largura e altura. Se for um celular em modo retrato ele cuida de inverter as dimens√µes.

## Exibindo o v√≠deo na p√°gina

Ok, agora que temos o stream, o que podemos fazer com ele?

Podemos exibir o v√≠deo na p√°gina, em um elemento , por exemplo:

```javascript
// considerando que existe um elemento
// <video autoplay id="video"></video>
// na p√°gina
const video = document.querySelector('#video')
const videoStream = await navigator.mediaDevices.getUserMedia(constraints)
video.srcObject = videoStream
```

Note o atributo `autoplay` na tag `video`. Sem ele voc√™ precisa chamar `video.play()` para come√ßar a exibir a imagem de fato.

## Acessando as c√¢meras frontal e traseira do celular

Por padr√£o o `getUserMedia` vai usar o dispositivo padr√£o de grava√ß√£o de v√≠deo do sistema. No caso de um celular com duas c√¢meras, ele usa a c√¢mera frontal.

Para acessar a c√¢mera traseira, devemos incluir `facingMode: "environment"` nos requisitos de v√≠deo:

```javascript
const constraints = {
  video: {
    width: { ... },
    height: { ... },
    facingMode: "environment"
  },
};
```

O padr√£o √© `facingMode: "user"`, que √© a c√¢mera frontal.

**Um ponto de aten√ß√£o**: se voc√™ quiser alterar a c√¢mera com o v√≠deo iniciado, √© preciso parar o stream atual antes de substituir pelo stream da outra c√¢mera:

```javascript
videoStream.getTracks().forEach((track) => {
  track.stop()
})
```

## Tirando screenshots

Outra coisa legal que d√° pra fazer √© capturar imagens (_screenshots_) do v√≠deo.

Voc√™ pode desenhar o _frame_ atual do v√≠deo em um [canvas](https://developer.mozilla.org/pt-BR/docs/Web/HTML/Canvas), por exemplo:

```javascript
// considerando que j√° existe um elemento
// <canvas id="canvas"></canvas>
// na p√°gina
const canvas = document.querySelector('#canvas')
canvas.width = video.videoWidth
canvas.height = video.videoHeight
canvas.getContext('2d').drawImage(video, 0, 0)
```

Voc√™ pode ainda passar o conte√∫do do canvas para um elemento .

No exemplo que criei para este tutorial, adicionei um bot√£o que cria imagens dinamicamente a partir do canvas e adiciona na p√°gina. Algo assim:

```javascript
const img = document.createElement('img')
img.src = canvas.toDataURL('image/png')
screenshotsContainer.prepend(img)
```

## Conclus√£o

Veja como ficou o exemplo rodando aqui: [https://doug2k1.github.io/javascript-camera/](https://doug2k1.github.io/javascript-camera/)

E o c√≥digo-fonte completo est√° aqui: [https://github.com/doug2k1/javascript-camera](https://github.com/doug2k1/javascript-camera)

**Este post foi √∫til? Compartilhe nas suas redes pra dar aquela for√ßa.** üòâ
